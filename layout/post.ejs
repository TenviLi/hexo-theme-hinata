<% function generateReadtime(post) {
    const words = word_count(post._content);
    const time = duration((words / 150.0) * 60, 'seconds');
    return `${ time.locale(get_config('language', 'en')).humanize() } 读完} (大约 ${ words } 个字)`;
} 
const readtime = generateReadtime(); %>
<main class="content" role="main">
    <header class="main-header post-head">
        <div class="cover js-post-cover"<% if (has_thumbnail(post)) { %>url="<%= get_thumbnail(post) %>"<% } %>></div>
        <div class="overlay"></div>
        <div class="post-meta js-post-meta">
            <h1 class="post-title"><%= post.title %></h1>
            <div class="meta-info">
                <svg class="icon icon-clock"><use xlink:href="#icon-clock"></use></svg>
                <time class="post-date" datetime="<%= date_xml(post.date) %>">  <%= date(post.date) %></time>
                <% if (!has_config('article.readtime') || get_config('article.readtime') === true) { %>
                |  <span class="js-read-time">
                      <%= readtime %>
                </span>
            <% } %>
            </div>
            <% if (post.tags && post.tags.length) { %>
            <div class="tags" >
                <svg class="icon icon-ribbon"><use xlink:href="#icon-ribbon"></use></svg>
                <%- list_tags(post.tags, {
                    class: 'has-link-grey ',
                    show_count: false,
                    style: 'link'
                }) %>
            </div>
            <% } %>
        </div>
    </header>

    <div class="post-banner">
        <div class="wrap js-wrap-text"></div>
    </div>

    <article class="{{post_class}} js-article">
        <div class="meta-info">
            <svg class="icon icon-clock"><use xlink:href="#icon-clock"></use></svg>
            <time class="post-date" datetime="<%= date_xml(post.date) %>">  <%= date(post.date) %></time>
            <% if (!has_config('article.readtime') || get_config('article.readtime') === true) { %>
                |  <span class="js-read-time">
                      <%= readtime %>
                </span>
            <% } %>
        </div>
        <section class="post-content">
            <%- post.content %>
        </section>
        <!-- Go to www.addthis.com/dashboard to customize your tools -->
        <div style="margin-top:10px;" class="addthis_sharing_toolbox"></div>
        <!--disqus-->
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES * * */
            var disqus_shortname = 'jackpusjourney';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
        <!--end disqus-->
    </article>

    <aside class="read-next">
        <div class="blur-bannar">
        </div>
        <div class="container">
            <h5 class="suggest-read-title"><svg class="icon icon-star"><use xlink:href="#icon-star"></use></svg> 推荐阅读</h5>
            <% if (post.categories && post.categories.length) { %>
<% const primary_categories =  post.categories;
  const difference = (a, b) => { const s = new Set(b); return a.filter(x => !s.has(x)) }; 
%>
            <% posts.filter(p => has_thumbnail(p) && (p.categories && p.categories.length) && difference(p.categories, primary_categories).length).sort('date', -1).limit(8).each(recommend_post => { %>
                    <a class="read-next-story "  href="<%- url_for((post.link?post.link:post.path)) %>">
                        <div class="cover"<% if (has_thumbnail(recommend_post)) { %>style="background-image: url(<%= get_thumbnail(recommend_post) %>)"<% } %>>
                            <div class="post-tag">
                                <%- list_tags(recommend_post.tags, {
                                class: 'has-link-grey ',
                                show_count: false,
                                style: 'link'
                                }) %>
                            </div>
                        </div>
                        <section>
                            <time class="post-date" datetime="<%= date_xml(recommend_post.date) %>">  <%= date(recommend_post.date) %></time>
                            <h5><%= recommend_post.title %></h5>
                        </section>
                    </a>
            <% } %>
        </div>
    </aside>

    <div class="social-sites">
        <div class="blur-circle sm">
            <svg width="150px" height="150px" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="gradient1" gradientTransform="rotate(35)">
                        <stop offset="0%"  stop-color="#ab7bf6" />
                        <stop offset="95%" stop-color="#7022ed" />
                    </linearGradient>
                    <filter id="f1" x="0" y="0">
                        <feGaussianBlur in="SourceGraphic" stdDeviation="2" />
                    </filter>
                </defs>
                <circle cx="50" fill="url(#gradient1)" filter="url(#f1)" cy="50" r="40"/>
            </svg>
        </div>
        <div class="blur-circle md">
            <svg width="180px" height="180px" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="gradient1" gradientTransform="rotate(35)">
                        <stop offset="0%"  stop-color="#ab7bf6" />
                        <stop offset="95%" stop-color="#7022ed" />
                    </linearGradient>
                    <filter id="f1">
                        <feGaussianBlur in="SourceGraphic" stdDeviation="1" />
                    </filter>
                </defs>
                <circle cx="50" fill="url(#gradient1)" filter="url(#f1)" cy="50" r="35"/>
            </svg>
        </div>
        <div class="blur-circle lg">
            <svg width="280px" height="280px" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="gradient2" gradientTransform="rotate(35)">
                        <stop offset="0%"  stop-color="#c471ed" />
                        <stop offset="95%" stop-color="#3F5EFB" />
                    </linearGradient>
                    <filter id="f3">
                        <feGaussianBlur in="SourceGraphic" stdDeviation="1" />
                    </filter>
                </defs>
                <circle cx="50" fill="url(#gradient2)" filter="url(#f3)" cy="50" r="45"/>
            </svg>
        </div>
        <div class="blur-circle sm">
            <svg width="120px" height="120px" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="gradient4">
                        <stop offset="5%" stop-color="#5573e3" />
                        <stop offset="95%"  stop-color="#7022ed" />
                    </linearGradient>
                    <filter id="f4" x="0" y="0">
                        <feGaussianBlur in="SourceGraphic2" stdDeviation="2" />
                    </filter>
                </defs>
                <circle cx="50" fill="url(#gradient4)" filter="url(#f4)" cy="50" r="35"/>
            </svg>
        </div>
        <div class="blur-circle sm">
            <svg width="100px" height="100px" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" fill="url(#gradient1)" filter="url(#f1)" cy="50" r="40"/>
            </svg>
        </div>

        <%- partial('post/sns') %>
    </div>

</main>


<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-55d88bec2ab91030" async="async"></script>
